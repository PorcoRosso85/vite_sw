{"version":3,"file":"index-19c9fc5c.js","sources":["../../../../../../../../@vite-plugin-pwa/virtual:pwa-register","../../src/main.ts"],"sourcesContent":["// src/client/build/register.ts\nvar autoUpdateMode = \"true\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      await sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      const { Workbox } = await import(\"workbox-window\");\n      wb = new Workbox(\"/sw.js\", { scope: \"/\", type: \"classic\" });\n      sendSkipWaitingMessage = async () => {\n        await wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                if (event.isExternal)\n                  window.location.reload();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n          wb.addEventListener(\"externalwaiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"/sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\nexport {\n  registerSW\n};\n","import { pwaInfo } from 'virtual:pwa-info'\nimport { registerSW } from 'virtual:pwa-register'\n\nconst date = __DATE__\n\n// eslint-disable-next-line no-console\nconsole.log(pwaInfo)\n\nconst app = document.querySelector<HTMLDivElement>('#app')!\n\napp.innerHTML = `\n  <div>\n   <img src=\"/favicon.svg\" alt=\"PWA Logo\" width=\"60\" height=\"60\">\n    <h1>Vite + TypeScript</h1>\n    <p>Testing SW without <b>Injection Point (self.__WB_MANIFEST)</b></p>\n    <br/>\n    <p>${date}</p>\n    <br/>\n  </div>\n`\n\nregisterSW({\n  immediate: true,\n  onNeedRefresh() {\n    // eslint-disable-next-line no-console\n    console.log('onNeedRefresh message should not appear')\n  },\n  onOfflineReady() {\n    // eslint-disable-next-line no-console\n    console.log('onOfflineReady message should not appear')\n  },\n})\n"],"names":["registerSW","options","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","updateServiceWorker","_reloadPage","register","Workbox","__vitePreload","event","r","e","date","pwaInfo","app"],"mappings":"ijDAKA,SAASA,EAAWC,EAAU,GAAI,CAChC,KAAM,CACJ,UAAAC,EAAY,GACZ,cAAAC,EACA,eAAAC,EACA,aAAAC,EACA,eAAAC,EACA,gBAAAC,CACD,EAAGN,EACJ,IAAIO,EACAC,EAEJ,MAAMC,EAAsB,MAAOC,EAAc,KAAS,CACxD,MAAMF,CAIV,EACE,eAAeG,GAAW,CACxB,GAAI,kBAAmB,UAAW,CAChC,KAAM,CAAE,QAAAC,CAAO,EAAK,MAAMC,EAAA,IAAA,OAAO,yCAAgB,kBAAA,EACjDN,EAAK,IAAIK,EAAQ,SAAU,CAAE,MAAO,IAAK,KAAM,SAAS,CAAE,EAMtDL,EAAG,iBAAiB,YAAcO,GAAU,EACtCA,EAAM,UAAYA,EAAM,aAC1B,OAAO,SAAS,QAC9B,CAAW,EACDP,EAAG,iBAAiB,YAAcO,GAAU,CACrCA,EAAM,UACTX,GAAA,MAAAA,GAEd,CAAW,EAgCLI,EAAG,SAAS,CAAE,UAAAN,CAAW,CAAA,EAAE,KAAMc,GAAM,CACjCV,EACFA,EAAe,SAAUU,CAAC,EAE1BX,GAAA,MAAAA,EAAeW,EACzB,CAAO,EAAE,MAAOC,GAAM,CACdV,GAAA,MAAAA,EAAkBU,EAC1B,CAAO,CACF,CACF,CACD,OAAAR,EAAkBG,EAAQ,EACnBF,CACT,CCjFA,MAAMQ,EAAO,2BAGb,QAAQ,IAAIC,CAAO,EAEnB,MAAMC,EAAM,SAAS,cAA8B,MAAM,EAEzDA,EAAI,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAMPF;AAAA;AAAA;AAAA,EAKTlB,EAAW,CACT,UAAW,GACX,eAAgB,CAEd,QAAQ,IAAI,yCAAyC,CACvD,EACA,gBAAiB,CAEf,QAAQ,IAAI,0CAA0C,CACxD,CACF,CAAC"}